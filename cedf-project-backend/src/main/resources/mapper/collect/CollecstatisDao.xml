<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.nakong.modules.collect.dao.CollecstatisDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="io.nakong.modules.collect.entity.CollecstatisEntity" id="collecstatisMap">
        <result property="id" column="id"/>
        <result property="collectData" column="collect_data"/>
        <result property="collectType" column="collect_type"/>
        <result property="equipId" column="equip_id"/>
        <result property="hour" column="hour"/>
        <result property="minu" column="minu"/>
        <result property="second" column="second"/>
        <result property="month" column="month"/>
        <result property="year" column="year"/>
        <result property="weekMonth" column="week_month"/>
        <result property="dayYear" column="day_year"/>
        <result property="insertTime" column="insert_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="dateStr" column="dateStr"/>

    </resultMap>

     <select id="comparisonChartByDay" resultType="io.nakong.modules.collect.entity.CollecstatisEntity">
           select sum(collect_data)/count(1) collect_data,date_format(t.insert_time, '%Y-%m-%d %H ') insert_time from   t_collect_statis_day t where t.equip_id = #{equipId}
            and t.collect_type = #{compareType}
            and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
            group by date_format(t.insert_time, '%Y-%m-%d %H')
     </select>


    <select id="comparisonChartByWeek" resultType="io.nakong.modules.collect.entity.CollecstatisEntity">
           select sum(collect_data)/count(1) collect_data,date_format(t.insert_time, '%Y-%m-%d') insert_time from   t_collect_statis_day t where t.equip_id = #{equipId}
            and t.collect_type = #{compareType}
            and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
            group by date_format(t.insert_time, '%Y-%m-%d')
     </select>

    <select id="comparisonChartByMonth" resultType="io.nakong.modules.collect.entity.CollecstatisEntity">
           select sum(collect_data)/count(1) collect_data,date_format(t.insert_time, '%Y-%m-%d') insert_time from   t_collect_statis_day t where t.equip_id = #{equipId}
            and t.collect_type = #{compareType}
            and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
            group by date_format(t.insert_time, '%Y-%m-%d')
     </select>

    <select id="comparisonChartByYear" resultType="io.nakong.modules.collect.entity.CollecstatisEntity">
           select sum(collect_data)/count(1) collect_data,date_format(t.insert_time, '%Y-%m') insert_time
            from   t_collect_statis_day t where t.equip_id = #{equipId}
            and t.collect_type = #{compareType}
            and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
            group by date_format(t.insert_time, '%Y-%m')
     </select>

    <select id="getCollectData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
           select sum(collect_data)  data  from   t_collect_statis_day t where 1=1
            and t.collect_type = #{collectType}
            and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
     </select>

    <select id="getAirCollectData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
          SELECT sum(t.collec_value) data,equip_id  FROM  t_pipe  t
            where 1=1 and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
            group by t.equip_id
    </select>


    <select id="getAirPowerCollectData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
          select  sum(tp.collec_value) data, sum(t.collec_value) powerData,t.equip_id
            from t_power t ,t_pipe tp where t.equip_id = tp.equip_id
              and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
            group by  t.equip_id
    </select>

    <select id="getPowerCollectData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select  sum(t.collec_value) powerData,t.equip_id
        from t_power t  where 1=1
          and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by  t.equip_id
    </select>

    <select id="getSumAirData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select  date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,t.equip_id equipId,sum(t.collec_value) data
        from t_pipe t
        where 1=1 and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i') ,t.equip_id
    </select>

    <select id="sumPowerData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select  date_format(t.insert_time, '%Y-%m-%d %H:%i') date,t.equip_id equipId,sum(t.collec_value) data
        from t_power t
        where 1=1 and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i') ,t.equip_id
    </select>

    <select id="sumPipeData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select  date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,t.equip_id equipId,sum(t.collec_value) data
        from t_pipe t
        where 1=1 and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
         group by date_format(t.insert_time, '%Y-%m-%d %H:%i') ,t.equip_id
         order by t.insert_time desc
    </select>

    <select id="sumTempData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select  date_format(t.insert_time, '%Y-%m-%d %H:%i') date,t.equip_id equipId,sum(t.collec_value) data
        from  t_temp t
        where 1=1 and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i') ,t.equip_id
    </select>

    <select id="alarmData" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select  date_format(t.insert_time, '%Y-%m-%d %H:%i') date,t.equip_id equipId,sum(t.collec_value) data
        from  t_alarm t
        where 1=1 and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i') ,t.equip_id
    </select>

    <select id="airPowerRate" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select   t.equip_id equipId,sum(t.collec_value) data,sum(tp.collec_value) powerData
        from  t_pipe t ,t_power tp
        where t.equip_id = tp.equip_id and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by  t.equip_id
    </select>

    <select id="pressDataPageList"  parameterType="io.nakong.common.page.Page" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select   date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,sum(t.collec_value) data,t.equip_id  equipId
        from  t_press t
        where 1=1 and  <![CDATA[ t.insert_time >= #{map.startDate} and t.insert_time <= #{map.endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i'),t.equip_id
    </select>

    <select id="pipeDataPageList"  parameterType="io.nakong.common.page.Page" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select   date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,sum(t.collec_value) data,t.equip_id  equipId
        from  t_pipe t
        where 1=1 and  <![CDATA[ t.insert_time >= #{map.startDate} and t.insert_time <= #{map.endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i'),t.equip_id
    </select>
    <select id="powerDataPageList"  parameterType="io.nakong.common.page.Page" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select   date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,sum(t.collec_value) data,t.equip_id  equipId
        from  t_power t
        where 1=1 and  <![CDATA[ t.insert_time >= #{map.startDate} and t.insert_time <= #{map.endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i'),t.equip_id
    </select>
    <select id="ldDataPageList"  parameterType="io.nakong.common.page.Page"  resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select   date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,sum(t.collec_value) data,t.equip_id  equipId
        from  t_press_ld t
        where 1=1 and  <![CDATA[ t.insert_time >= #{map.startDate} and t.insert_time <= #{map.endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i'),t.equip_id
    </select>
    <select id="tempDataPageList"  parameterType="io.nakong.common.page.Page" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select   date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,sum(t.collec_value) data,t.equip_id  equipId
        from  t_temp t
        where 1=1 and  <![CDATA[ t.insert_time >= #{map.startDate} and t.insert_time <= #{map.endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H:%i'),t.equip_id
    </select>

<!-- 空气成本 excel  -->

    <select id="airCostChartByDay" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
        select sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) powerData,
        sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) data,
        date_format(t.insert_time, '%Y-%m-%d %H ') insert_time,equip_id equipId
        from   t_collect_statis_day t
        where
        t.equip_id in
        <foreach item="equipId" collection="array" open="(" separator="," close=")">
            #{equipId}
        </foreach>
        and t.collect_type in (2,3)
        and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d %H'),equip_id
     </select>


    <select id="airCostByWeek" resultType="io.nakong.modules.collect.entity.CompareDataEntity">

        select sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) powerData,
        sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) data,
        date_format(t.insert_time, '%Y-%m-%d') insert_time,equip_id equipId
        from   t_collect_statis_day t
        where
        t.equip_id in
        <foreach item="equipId" collection="array" open="(" separator="," close=")">
            #{equipId}
        </foreach>
        and t.collect_type in (2,3)
        and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d'),equip_id

     </select>

    <select id="airCostByMonth" resultType="io.nakong.modules.collect.entity.CompareDataEntity">

        select sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) powerData,
        sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) data,
        date_format(t.insert_time, '%Y-%m-%d') insert_time,equip_id equipId
        from   t_collect_statis_day t
        where
        t.equip_id in
        <foreach item="equipId" collection="array" open="(" separator="," close=")">
            #{equipId}
        </foreach>
        and t.collect_type in (2,3)
        and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m-%d'),equip_id

     </select>

    <select id="airCostByYear" resultType="io.nakong.modules.collect.entity.CompareDataEntity">

        select sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) powerData,
        sum(if(collect_type = 2,collect_data,0))/count(if(collect_type = 2,1,0)) data,
        group by date_format(t.insert_time, '%Y-%m') date_format(t.insert_time, '%Y-%m-%d') insert_time,equip_id equipId
        from   t_collect_statis_day t
        where
        t.equip_id in
        <foreach item="equipId" collection="array" open="(" separator="," close=")">
            #{equipId}
        </foreach>
        and t.collect_type in (2,3)
        and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
        group by date_format(t.insert_time, '%Y-%m'),equip_id
     </select>

    <select id="sumPipePageList"    resultMap="collecstatisMap">
       select  date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,t.equip_id equipId,sum(t.collec_value) data
        from t_pipe t
        where 1=1 and  <![CDATA[ t.insert_time >= #{startDate} and t.insert_time <= #{endDate} ]]>
         group by date_format(t.insert_time, '%Y-%m-%d %H:%i') ,t.equip_id
         order by t.insert_time desc
	</select>

    <select id="queryListPipePageList"    parameterType="io.nakong.common.page.Page" resultType="io.nakong.modules.collect.entity.CompareDataEntity">
       select  date_format(t.insert_time, '%Y-%m-%d %H:%i') dateStr,t.equip_id equipId,sum(t.collec_value) data
        from t_pipe t
        where 1=1 and  <![CDATA[ t.insert_time >= #{map.startDate} and t.insert_time <= #{map.endDate} ]]>
         group by date_format(t.insert_time, '%Y-%m-%d %H:%i') ,t.equip_id
         order by t.insert_time desc
	</select>

</mapper>